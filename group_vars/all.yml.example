# ====================================================================
# GertGerber Dotfiles Configuration Example
# Save this as: group_vars/all.yml
# ====================================================================

# --------------------------------------------------------------------
# USER CONFIGURATION
# --------------------------------------------------------------------
git_user_name: "GertGerber"

# --------------------------------------------------------------------
# PROFILE-DRIVEN ROLE SELECTION
# --------------------------------------------------------------------

# Options: minimal | web | devops | full
run_profile: devops

# Exclude roles from the final set (e.g. corp restrictions)
exclude_roles: []  # e.g. [discord, spotify, brave]

# OS-specific role additions (keys map to ansible_system: Darwin | Linux | Windows)
os_role_overrides:
  Darwin:  [raycast, hammerspoon, orbstack, aldente, kitty, ghostty, warp]
  Linux:   [flatpak, nala, alacritty, kitty, ghostty, warp]
  Windows: [winget, pwsh]

# Profiles (role names must match directories under roles/)
role_profiles:
  minimal: [
    system, fonts, git,
    bash, fzf, zoxide, bat, lsd, tldr
  ]

  web: "{{ role_profiles['minimal'] + [
    'nvm','npm','python','gh','lazygit','neovim','tmux','brave'
  ] }}"

  devops: "{{ role_profiles['minimal'] + [
    'docker','helm','kubectl','k9s','terraform','awscli','azurecli',
    'just','taskfile','btop','ncdu','ssh','sshfs','tmate'
  ] }}"

  full: "{{ (role_profiles['web'] + role_profiles['devops'] + [
    'starship','zsh','obsidian','alacritty','kitty','ghostty',
    'wireguard','kind','kwctl','goreleaser','nomad',
    '1password','tshark','slides','asciiquarium','whalebrew','zellij','spotify','discord','warp'
  ]) | unique }}"

# Final role selection:
# - Start with the chosen profile
# - Add OS-specific roles via os_role_overrides
# - Remove exclude_roles
# - Deduplicate & sort for deterministic runs
default_roles: >-
  {{
    (role_profiles[run_profile] | default(role_profiles['minimal']))
    + (os_role_overrides.get(ansible_system, []))
    | difference(exclude_roles)
    | unique
    | sort
  }}

# --------------------------------------------------------------------
# LANGUAGE / TOOL CONFIGURATION
# --------------------------------------------------------------------

# --- Kubernetes CLI (kubectl) ---
kubectl:
  version: "v1.29.3"  # Pin to a cluster-compatible version

# --- Helm repositories ---
helm:
  repos:
    - { name: traefik,    url: "https://helm.traefik.io/traefik" }
    - { name: prometheus, url: "https://prometheus-community.github.io/helm-charts" }
    - { name: grafana,    url: "https://grafana.github.io/helm-charts" }

# --- Go packages ---
go:
  packages:
    - { package: "github.com/go-task/task/v3/cmd/task@latest", cmd: "task" }
    - { package: "github.com/stern/stern@latest",               cmd: "stern" }
    - { package: "github.com/golangci/golangci-lint/cmd/golangci-lint@latest", cmd: "golangci-lint" }

# --- Python packages ---
python:
  packages:
    - virtualenv
    - pipenv
    - black
    - flake8
    - pytest

# --- Node.js via nvm ---
node:
  default_version: "20"
  packages:
    - yarn
    - typescript
    - eslint
    - prettier

# --------------------------------------------------------------------
# SYSTEM / INTEGRATIONS
# --------------------------------------------------------------------

# Example: manage /etc/hosts via 1Password (experimental)
# op:
#   system:
#     hosts:
#       - { vault_path: "op://DevOps/Internal Services/hosts_entry", account: "my.1password.com" }

# --------------------------------------------------------------------
# TROUBLESHOOTING
# --------------------------------------------------------------------
# 1) "Role not found": ensure directory exists under roles/ and name matches tag.
# 2) Nothing runs: check diagnostics for run_roles/available_roles; verify default_roles is computed as expected.
# 3) Corporate blocks (e.g., Discord/Spotify): add to exclude_roles.
# 4) Version drift: pin CLI/tool versions in role vars and Galaxy requirements.
#
# Targeted execution:
#   ansible-playbook main.yml -i localhost, -t bash,zoxide
# Skip specific roles:
#   ansible-playbook main.yml -i localhost, --skip-tags docker
